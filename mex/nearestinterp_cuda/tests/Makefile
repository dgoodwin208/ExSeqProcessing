# SYNOPSIS:
#
#   make [all]  - makes everything.
#   make TARGET - makes the given target.
#   make clean  - removes all files generated by make.

.SUFFIXES: .cu

#GTEST_DIR=/mp/nas1/share/lib/googletest/googletest
GTEST_DIR=/home/kajita

CUDA_INC=/usr/local/cuda/include
CUDA_LIB=/usr/local/cuda/lib64

SPDLOG_DIR=../../include
CUDA_UTILS_DIR=../../cuda-utils

TESTS=gtest_nearestinterp

GTEST_HEADERS=$(GTEST_DIR)/include/gtest/*.h \
              $(GTEST_DIR)/include/gtest/internal/*.h
GTEST_LIBS=$(GTEST_DIR)/lib64/libgtest_main.a $(GTEST_DIR)/lib64/libgtest.a

CPPFLAGS+=-isystem $(GTEST_DIR)/include -I$(CUDA_UTILS_DIR) -I$(SPDLOG_DIR) -I..
CXXFLAGS+=-g -std=c++11 -Wall -Wextra -pthread
NVCCFLAGS=-g -std=c++11 --gpu-architecture=sm_61


all: $(TESTS)

clean:
	rm -f $(TESTS) *.o


#gtest_cudautils_kernel.o : gtest_cudautils_kernel.cu $(GTEST_HEADERS)
#	nvcc $(CPPFLAGS) $(NVCCFLAGS) -I$(CUDAUTILS_DIR) -I$(SPDLOG_DIR) -c gtest_cudautils_kernel.cu
#
#gtest_cudautils_kernel : gtest_cudautils_kernel.o $(CUDAUTILS_DIR)/libcudautils_test.a
#	$(CXX) $(CPPFLAGS) $(CXXFLAGS) $(GTEST_DIR)/libgtest_main.a $(GTEST_DIR)/libgtest.a -lpthread -o $@ $^ -L$(CUDA_LIB) -lcudart

nearestinterp.o: ../nearestinterp.cu
	nvcc $(NVCCFLAGS) $(CPPFLAGS) -Xcompiler -fPIC -c -o $@ $<

gtest_nearestinterp.o: gtest_nearestinterp.cu $(GTEST_HEADERS)
	nvcc $(NVCCFLAGS) $(CPPFLAGS) -c $<

gtest_nearestinterp: gtest_nearestinterp.o ./nearestinterp.o $(CUDA_UTILS_DIR)/libcudautils.a
	$(CXX) $(CXXFLAGS) $(GTEST_LIBS) -lpthread -o $@ $^ -L$(CUDA_LIB) -lcudart


